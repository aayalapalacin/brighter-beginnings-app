// scripts/generate-about-data.js

const fs = require('fs');
const path = require('path');

// --- PATHS FOR ABOUT DATA ---

// Path to the about.json content file (input from Netlify CMS)
// From the 'scripts' folder (__dirname), go up two levels (../../) to 'brighterBeginnings/',
// then navigate into 'content/pages/about.json'.
const ABOUT_JSON_PATH = path.resolve(__dirname, '..', '..', 'content', 'pages', 'about.json');

// Directory where the generated JavaScript file will be saved for your React app to import.
// From the 'scripts' folder (__dirname), go up one level (../) to 'src/',
// then navigate into 'data'.
const OUTPUT_DIR = path.resolve(__dirname, '..', 'data');

// Full path for the output about.js file
const OUTPUT_FILE = path.join(OUTPUT_DIR, 'about.js');

// --- END PATHS ---


// Ensure the output directory exists
if (!fs.existsSync(OUTPUT_DIR)) {
  fs.mkdirSync(OUTPUT_DIR, { recursive: true });
}

let aboutData = {}; // Initialize with an empty object

// Read the about.json file
if (fs.existsSync(ABOUT_JSON_PATH)) {
  const fileContent = fs.readFileSync(ABOUT_JSON_PATH, 'utf8');
  try {
    aboutData = JSON.parse(fileContent);
  } catch (error) {
    console.error(`Error parsing JSON from ${ABOUT_JSON_PATH}:`, error);
    // Fallback to empty object if parsing fails, to avoid breaking the build
    aboutData = {};
  }
} else {
  console.warn(`Warning: '${ABOUT_JSON_PATH}' not found. About page data will be empty. Make sure to create it via Netlify CMS.`);
  // If the file doesn't exist, ensure aboutData is an empty object
  aboutData = {};
}

// Generate the JavaScript file that exports the about page data
const jsContent = `
// This file is auto-generated by generate-about-data.js. Do not edit manually.
const aboutPageData = ${JSON.stringify(aboutData, null, 2)};

export default aboutPageData;
`;

fs.writeFileSync(OUTPUT_FILE, jsContent, 'utf8');

console.log(`Generated about page data to ${OUTPUT_FILE}`);