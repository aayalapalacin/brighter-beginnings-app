const fs = require('fs');
const path = require('path');

// Path where Netlify CMS saves your reviews.json
const reviewsJsonPath = path.join(__dirname, 'content', 'pages', 'reviews.json');
// Path where the generated JavaScript file will be saved for your React app to import
const outputFilePath = path.join(__dirname, 'src', 'data', 'reviews.js');

// Ensure the output directory exists
const outputDir = path.dirname(outputFilePath);
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

let reviewsData = {};

// Read the reviews.json file
if (fs.existsSync(reviewsJsonPath)) {
  const fileContent = fs.readFileSync(reviewsJsonPath, 'utf8');
  try {
    reviewsData = JSON.parse(fileContent);
  } catch (error) {
    console.error(`Error parsing JSON from ${reviewsJsonPath}:`, error);
    // Fallback to empty object if parsing fails, to avoid breaking the build
    reviewsData = {};
  }
} else {
  console.warn(`Warning: '${reviewsJsonPath}' not found. Reviews data will be empty.`);
  // If the file doesn't exist, ensure reviewsData is an empty object
  reviewsData = {};
}

// Generate the JavaScript file that exports the reviews data
const jsContent = `
// This file is auto-generated by generate-reviews-data.js. Do not edit manually.
const reviewsPageData = ${JSON.stringify(reviewsData, null, 2)};

export default reviewsPageData;
`;

fs.writeFileSync(outputFilePath, jsContent, 'utf8');

console.log(`Generated reviews page data to ${outputFilePath}`);