const fs = require('fs');
const path = require('path');

// --- CORRECTED PATHS ---

// Path to the reviews.json content file
// From the 'scripts' folder (__dirname), go up one level (..) to the project root ('brighterBeginnings'),
// then navigate into 'content/pages/reviews.json'.
const REVIEWS_JSON_PATH = path.resolve(__dirname, '..', 'content', 'pages', 'reviews.json');

// Directory where the generated JavaScript file will be saved for your React app to import.
// From the 'scripts' folder (__dirname), go up one level (..) to the project root,
// then navigate into 'src/data'.
const OUTPUT_DIR = path.resolve(__dirname, '..', 'src', 'data');

// Full path for the output reviews.js file
const OUTPUT_FILE = path.join(OUTPUT_DIR, 'reviews.js');

// --- END CORRECTED PATHS ---


// Ensure the output directory exists
if (!fs.existsSync(OUTPUT_DIR)) { // Changed to use OUTPUT_DIR
  fs.mkdirSync(OUTPUT_DIR, { recursive: true });
}

let reviewsData = {};

// Read the reviews.json file
if (fs.existsSync(REVIEWS_JSON_PATH)) { // Changed to use REVIEWS_JSON_PATH
  const fileContent = fs.readFileSync(REVIEWS_JSON_PATH, 'utf8'); // Changed to use REVIEWS_JSON_PATH
  try {
    reviewsData = JSON.parse(fileContent);
  } catch (error) {
    console.error(`Error parsing JSON from ${REVIEWS_JSON_PATH}:`, error);
    // Fallback to empty object if parsing fails, to avoid breaking the build
    reviewsData = {};
  }
} else {
  console.warn(`Warning: '${REVIEWS_JSON_PATH}' not found. Reviews data will be empty.`); // Changed to use REVIEWS_JSON_PATH
  // If the file doesn't exist, ensure reviewsData is an empty object
  reviewsData = {};
}

// Generate the JavaScript file that exports the reviews data
const jsContent = `
// This file is auto-generated by generate-reviews-data.js. Do not edit manually.
const reviewsPageData = ${JSON.stringify(reviewsData, null, 2)};

export default reviewsPageData;
`;

fs.writeFileSync(OUTPUT_FILE, jsContent, 'utf8'); // Changed to use OUTPUT_FILE

console.log(`Generated reviews page data to ${OUTPUT_FILE}`); // Changed to use OUTPUT_FILE