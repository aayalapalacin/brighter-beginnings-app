const fs = require('fs');
const path = require('path');

// --- CORRECTED PATHS ---

// Path to the forms.json content file
// From the 'scripts' folder (__dirname), go up one level (..) to the project root ('brighterBeginnings'),
// then navigate into 'content/pages/forms.json'.
const FORMS_JSON_PATH = path.resolve(__dirname, '..', 'content', 'pages', 'forms.json');

// Directory where the generated JavaScript file will be saved for your React app to import.
// From the 'scripts' folder (__dirname), go up one level (..) to the project root,
// then navigate into 'src/data'.
const OUTPUT_DIR = path.resolve(__dirname, '..', 'src', 'data');

// Full path for the output forms.js file
const OUTPUT_FILE = path.join(OUTPUT_DIR, 'forms.js');

// --- END CORRECTED PATHS ---


// Ensure the output directory exists
if (!fs.existsSync(OUTPUT_DIR)) { // Changed to use OUTPUT_DIR
  fs.mkdirSync(OUTPUT_DIR, { recursive: true });
}

let formsData = {};

// Read the forms.json file
if (fs.existsSync(FORMS_JSON_PATH)) { // Changed to use FORMS_JSON_PATH
  const fileContent = fs.readFileSync(FORMS_JSON_PATH, 'utf8'); // Changed to use FORMS_JSON_PATH
  try {
    formsData = JSON.parse(fileContent);
  } catch (error) {
    console.error(`Error parsing JSON from ${FORMS_JSON_PATH}:`, error);
    // Fallback to empty object if parsing fails, to avoid breaking the build
    formsData = {};
  }
} else {
  console.warn(`Warning: '${FORMS_JSON_PATH}' not found. forms data will be empty.`); // Changed to use FORMS_JSON_PATH
  // If the file doesn't exist, ensure formsData is an empty object
  formsData = {};
}

// Generate the JavaScript file that exports the forms data
const jsContent = `
// This file is auto-generated by generate-forms-data.js. Do not edit manually.
const formsPageData = ${JSON.stringify(formsData, null, 2)};

export default formsPageData;
`;

fs.writeFileSync(OUTPUT_FILE, jsContent, 'utf8'); // Changed to use OUTPUT_FILE

console.log(`Generated forms page data to ${OUTPUT_FILE}`); // Changed to use OUTPUT_FILE